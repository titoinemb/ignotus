{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///media/a/Dev/ignotus/app/src/app/hooks/useAccount.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { AccountState} from \"@types\";\nimport { session } from '../functions';\n\nexport const useAccount = (json: any) => {\n  const [state, setState] = useState<AccountState>({\n    idsession: null,\n    loading: true,\n    error: false,\n    sessionsHtml: [],\n    storageId: '',\n    premiumStatut: '',\n    listWishList: [],\n    listwatchList: [],\n    itemsData: [],\n  });\n  const queryParams: { [key: string]: string } = {};\n  \n  let location = useLocation();\n  let params = new URLSearchParams(location.search);\n\n  params.forEach((value, key) => {\n    queryParams[key] = value;\n  });\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    let cancelled = false;\n\n    const sleep = (ms: number) => new Promise(res => setTimeout(res, ms));\n    const maxAttempts = 3;\n\n    const run = async () => {\n      const rawSession = localStorage.getItem(\"session\");\n      const rawId = localStorage.getItem(\"username\");\n      if (!rawSession || !rawId) return;\n\n      for (let attempt = 1; attempt <= maxAttempts && !cancelled; attempt++) {\n        try {\n          const timeoutMs = 3000;\n          const sessionPromise = session(rawSession, rawId);\n          const sessionData = await Promise.race([\n            sessionPromise,\n            new Promise<number>((_, rej) => setTimeout(() => rej(new Error(\"timeout\")), timeoutMs))\n          ]) as number;\n\n          if (sessionData === 1) {\n            if (!cancelled) {\n              setState(s => ({ ...s, idsession: rawSession }));\n            }\n            return;\n          }\n\n          if (attempt < maxAttempts) {\n            await sleep(500 * 2 ** (attempt - 1));\n            continue;\n          }\n\n          if (!cancelled) {\n            localStorage.removeItem(\"session\");\n            localStorage.removeItem(\"username\");\n            window.location.href = \"\";\n          }\n          return;\n\n        } catch {\n          if (attempt === maxAttempts) {\n            if (!cancelled) {\n              localStorage.removeItem(\"session\");\n              localStorage.removeItem(\"username\");\n              window.location.href = \"\";\n            }\n            return;\n          }\n          await sleep(500 * 2 ** (attempt - 1));\n        }\n      }\n    };\n\n    run();\n\n    const fetchData = async () => {\n      try {\n        const response = await fetch('http://localhost:8080/ping', {\n          method: 'GET',\n          headers: { 'Content-Type': 'application/json' },\n        });\n\n        if (!response.ok) {\n          return setState(s => ({ ...s, error: true }));\n        }\n\n        if (localStorage.getItem('session')) {\n          const response2 = await fetch('http://localhost:8080/account/datas', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\n            body: JSON.stringify({\n              username: localStorage.getItem('username')!,\n              session: localStorage.getItem('session')!\n            }),\n          });\n\n          if (!response2.ok) {\n            return setState(s => ({ ...s, error: true }));\n          }\n\n          const datarep2 = await response2.json();\n          if (!datarep2 || datarep2.message !== \"1\") {\n            return setState(s => ({ ...s, error: true }));\n          }\n\n          const raw = datarep2.datas.premium;\n          const p = typeof raw === 'string' ? new Date(raw) : raw;\n          const days = Math.ceil((+p - Date.now()) / 86400000);\n\n          setState(s => ({\n            ...s,\n            sessionsHtml: datarep2.datas.session,\n            storageId: localStorage.getItem('username')!,\n            listWishList: datarep2.datas.wishlist,\n            listwatchList: datarep2.datas.watchList,\n            premiumStatut: days < 0 ? json.account.txt16 : json.account.txt17 + \" \" + days\n          }));\n        }\n\n      } catch {\n        setState(s => ({ ...s, error: true }));\n      } finally {\n        setState(s => ({ ...s, loading: false }));\n      }\n    };\n\n    fetchData();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [json.account]);\n\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      if (!state.listWishList || state.listWishList.length === 0) {\n        setState(s => ({ ...s, itemsData: [] }));\n        return;\n      }\n\n      try {\n        const results: any[] = [];\n\n        for (const item of state.listWishList) {\n          const res = await fetch('http://localhost:8080/item', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\n            body: JSON.stringify({ table: item.table, id: item.id }),\n          });\n\n          if (!res.ok) throw new Error();\n\n          const json = await res.json();\n          if (!json) throw new Error();\n\n          results.push({ id: item.id, data: json });\n        }\n\n        if (mounted) {\n          setState(s => ({ ...s, itemsData: results }));\n        }\n\n      } catch {\n        if (mounted) {\n          setState(s => ({ ...s, error: true }));\n        }\n      }\n    })();\n\n    return () => { mounted = false };\n  }, [state.listWishList]);\n\n  return {\n    ...state,\n    queryParams\n  };\n};"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;;;;AAEO,MAAM,aAAa,CAAC;IACzB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAe;QAC/C,WAAW;QACX,SAAS;QACT,OAAO;QACP,cAAc,EAAE;QAChB,WAAW;QACX,eAAe;QACf,cAAc,EAAE;QAChB,eAAe,EAAE;QACjB,WAAW,EAAE;IACf;IACA,MAAM,cAAyC,CAAC;IAEhD,IAAI,WAAW,IAAA,sKAAW;IAC1B,IAAI,SAAS,IAAI,gBAAgB,SAAS,MAAM;IAEhD,OAAO,OAAO,CAAC,CAAC,OAAO;QACrB,WAAW,CAAC,IAAI,GAAG;IACrB;IAEA,IAAA,kNAAS,EAAC;QACR,wCAAmC;;;QAEnC,IAAI;QAEJ,MAAM;QACN,MAAM;QAEN,MAAM;QAiDN,MAAM;IAwDR,GAAG;QAAC,KAAK,OAAO;KAAC;IAEjB,IAAA,kNAAS,EAAC;QACR,IAAI,UAAU;QACd,CAAC;YACC,IAAI,CAAC,MAAM,YAAY,IAAI,MAAM,YAAY,CAAC,MAAM,KAAK,GAAG;gBAC1D,SAAS,CAAA,IAAK,CAAC;wBAAE,GAAG,CAAC;wBAAE,WAAW,EAAE;oBAAC,CAAC;gBACtC;YACF;YAEA,IAAI;gBACF,MAAM,UAAiB,EAAE;gBAEzB,KAAK,MAAM,QAAQ,MAAM,YAAY,CAAE;oBACrC,MAAM,MAAM,MAAM,MAAM,8BAA8B;wBACpD,QAAQ;wBACR,SAAS;4BAAE,gBAAgB;4BAAoB,UAAU;wBAAmB;wBAC5E,MAAM,KAAK,SAAS,CAAC;4BAAE,OAAO,KAAK,KAAK;4BAAE,IAAI,KAAK,EAAE;wBAAC;oBACxD;oBAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI;oBAEvB,MAAM,OAAO,MAAM,IAAI,IAAI;oBAC3B,IAAI,CAAC,MAAM,MAAM,IAAI;oBAErB,QAAQ,IAAI,CAAC;wBAAE,IAAI,KAAK,EAAE;wBAAE,MAAM;oBAAK;gBACzC;gBAEA,IAAI,SAAS;oBACX,SAAS,CAAA,IAAK,CAAC;4BAAE,GAAG,CAAC;4BAAE,WAAW;wBAAQ,CAAC;gBAC7C;YAEF,EAAE,OAAM;gBACN,IAAI,SAAS;oBACX,SAAS,CAAA,IAAK,CAAC;4BAAE,GAAG,CAAC;4BAAE,OAAO;wBAAK,CAAC;gBACtC;YACF;QACF,CAAC;QAED,OAAO;YAAQ,UAAU;QAAM;IACjC,GAAG;QAAC,MAAM,YAAY;KAAC;IAEvB,OAAO;QACL,GAAG,KAAK;QACR;IACF;AACF"}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///media/a/Dev/ignotus/app/src/app/components/features/Account.tsx"],"sourcesContent":["import React from 'react';\r\nimport '../../styles/account.scss'\r\nimport '../../styles/all.scss';\r\nimport { deleteSession, login, deleteAccount, createAccount, saveKeys } from '../../functions';\r\nimport { Loading, Error500} from '../layout';\r\nimport { Props } from '@types';\r\nimport { useAccount } from \"../../hooks/useAccount\";\r\n\r\nexport const Account: React.FC<Props> = ({ json, lang }) => {\r\n  const { error, idsession, itemsData, listWishList, listwatchList, loading, premiumStatut, sessionsHtml, storageId, queryParams } = useAccount(json);\r\n\r\n  if (loading) return <Loading />;\r\n  if (error === true) return <Error500 lang={lang} json={json} />;\r\n\r\n  if (!idsession) {\r\n    if (!queryParams.i) {\r\n      return (\r\n        <div className='app'>\r\n          <div className=\"title\">{json.account.txt1}</div>\r\n          <div className=\"desc\">Username</div>\r\n          <div className=\"words\">\r\n            <input type=\"text\" id=\"word2\" />\r\n          </div>\r\n          <div className=\"desc\">{json.account.txt2}</div>\r\n          <div className='words'>\r\n            <input type=\"text\" id=\"word1\" />\r\n          </div>\r\n          <div className=\"error\" id='error1'>{json.account.txt8}</div>\r\n          <div className=\"error\" id='error2'>{json.account.txt9}</div>\r\n          <button onClick={login}>{json.account.txt1}</button>\r\n          <div className=\"create\" onClick={() => { window.location.href = \"/account?i=1\" }}>\r\n            {json.account.txt3}\r\n          </div>\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className='app'>\r\n          <div className=\"title\">{json.account.txt3}</div>\r\n          <div className=\"desc\" id='desc' style={{ display: \"none\" }}>Username</div>\r\n          <div className=\"words words2\" id='words3' style={{ display: \"none\" }}>\r\n            <input type=\"text\" id=\"word2Reg\" />\r\n          </div>\r\n          <div className=\"desc2\" id='desc' style={{ display: \"none\" }}>password</div>\r\n          <div className=\"words words2\" id='words2' style={{ display: \"none\" }}>\r\n            <input type=\"text\" id=\"word0Reg\" readOnly />\r\n          </div>\r\n          <button id=\"savebtn\" onClick={saveKeys} style={{ display: \"none\" }}>{json.account.txt6}</button>\r\n          <div className=\"saveok\" id='saveok'>{json.account.txt7}</div>\r\n          <div className=\"save\" id='save'>{json.account.txt5}</div>\r\n          <div id=\"security\" className=\"security\">{json.account.txt4}</div>\r\n          <button id=\"createReg\" onClick={createAccount}>{json.account.txt3}</button>\r\n          <div className=\"create\" onClick={() => { window.location.href = \"/account\" }}>\r\n            {json.account.txt1}\r\n          </div>\r\n        </div>\r\n      );\r\n    };\r\n  } else {\r\n    return (\r\n      <div className='app2'>\r\n        <div className=\"title\">{json.account.txt10}</div>\r\n        <div className=\"session\">\r\n          <div className=\"statut\">{json.account.txt14}</div>\r\n        </div>\r\n        <div className=\"premium\">\r\n          <div className=\"statut\">{json.account.txt18}</div>\r\n          {premiumStatut}\r\n        </div>\r\n        {listwatchList && listwatchList.length > 0 && (\r\n          <div className=\"sec\">\r\n            <div className=\"title\">{json.account.txt12}</div>\r\n            <div className=\"items\">\r\n              <ul>\r\n\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {listWishList && listWishList.length > 0 && (\r\n          <div className=\"sec\">\r\n            <div className=\"title\">{json.account.txt11}</div>\r\n            <div className=\"wishlist\">\r\n              <ul>\r\n                <>\r\n                  {itemsData.map((it) => {\r\n                    const item = it.data.data[0];\r\n                    const t = item.saisons ? 0 : 1;\r\n                    return (\r\n                      <li key={item._id}>\r\n                        <div\r\n                          className=\"linkId\"\r\n                          onClick={() => {\r\n                            window.location.href = `/item/?t=${t}&i=${item._id}`;\r\n                          }}\r\n                          onKeyDown={(e) => {\r\n                            if (e.key === \"Enter\" || e.key === \" \") {\r\n                              window.location.href = `/item/?t=${t}&i=${item._id}`;\r\n                            };\r\n                          }}\r\n                          style={{ cursor: \"pointer\" }}\r\n                        >\r\n                          <div className=\"image\">\r\n                            <div className=\"image2\"><img src={item.minipicture} alt=\"logo\" /></div>\r\n                            <img src={item.picture} alt=\"cover\" />\r\n                          </div>\r\n                        </div>\r\n                      </li>\r\n                    );\r\n                  })}\r\n                </>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div className=\"sec\">\r\n          <div className=\"title\">{json.account.txt13}</div>\r\n          <div className=\"items\">\r\n            <>\r\n              {sessionsHtml.map((item, index) => (\r\n                <div\r\n                  key={item.token}\r\n                  className=\"linkId\"\r\n                  id={item.token}\r\n                  onClick={() => {\r\n                    deleteSession(localStorage.getItem(\"session\") || \"\", storageId, index.toString());\r\n                  }}\r\n                >\r\n                  <div className=\"title\">{json.account.txt14} {item.name}</div>\r\n                  <div className=\"desc\">{json.account.txt15}</div>\r\n                </div>\r\n              ))}\r\n            </>\r\n          </div>\r\n        </div>\r\n        <button id=\"linkId\" onClick={deleteAccount}>{json.account.txt19}</button>\r\n      </div>\r\n    );\r\n  }\r\n};"],"names":[],"mappings":"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"}}]
}